<!DOCTYPE html>
<html lang="en">

        <%- include("partials/head") %>
        <link rel="stylesheet" href="/css/carrito-productos.css" />
        <script defer src="/js/cart.js"></script>
    </head>

    <%- include("partials/header") %>
    
    <body class="background">
        <main>
            <div class="below-head-bar">

                <h3 class="title text-center padding-24">Carrito de Compras</h3>
                <div class="cart-box-location">
        
                <div class="cart-box padding-24">
                    
                    <% if (e && cart && cart.products && cart.products.length > 0) { %> 
                        <div class="cart-header">
                            <div class="cart-flex m-2" style="border-bottom: 2px solid #ddd; padding-bottom: 12px;">
                                <div style="flex: 1;"><strong>Producto</strong></div>
                                <div style="min-width: 100px; text-align: center;"><strong>Cantidad</strong></div>
                                <div style="min-width: 100px; text-align: right;"><strong>Precio</strong></div>
                            </div>
                        </div>
                        
                        <% for (let item of cart.products) { %> 
                        <div class="cart-product-container">
                            <div class="cart-flex">
                                <div class="cart-info">
                                    <img src="/images/product-images/<%= item.product.image %>" alt="<%= item.product.name %>">
                                    <div>
                                        <p><%= item.product.name %></p>
                                        <form action="/carrito/remove/<%= item.productId %>" method="POST" style="margin-top: 8px;">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <button type="submit" class="btn-remove">Quitar</button>
                                        </form>
                                    </div>
                                </div>
                                <div class="quantity-section">
                                    <form action="/carrito/update/<%= item.productId %>" method="POST" class="quantity-form">
                                        <input type="hidden" name="_method" value="PUT">
                                        <input type="number" name="quantity" value="<%= item.quantity %>" min="1" max="10" onchange="this.form.submit()">
                                    </form>
                                </div>
                                <p class="article-price">$<%= item.subTotal.toFixed(2) %></p>
                            </div>
                        </div>
                        <% } %> 
                        
                        <div class="cart-total">
                            <h3>Total: $<%= cart.total.toFixed(2) %></h3>
                        </div>
                        
                        <section class="container-envio padding-24">
                            <h3>Información de envío</h3>
                            <p>El envío será calculado en el siguiente paso.</p>
                        </section>
                        
                        <div class="button-location text-center padding-24">
                            <form action="/carrito/checkout" method="POST">
                                <button class="boton-añadir" type="submit" style="width: 100%; max-width: 300px;">
                                    Proceder a pagar
                                </button>
                            </form>
                        </div>
                        
                    <% } else { %> 
                        <div class="empty-cart">
                            <p>No tienes productos en el carrito</p>
                            <a href="/products" class="btn-primary">Continuar comprando</a>
                        </div>
                    <% } %>

                    </div>
                </div>
            </div>
        </main>
        <%- include ("partials/footer.ejs") %>
    </body>
  
</html>